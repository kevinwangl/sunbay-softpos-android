# Android 主界面布局优化说明 v2

## 优化概述

采用下拉菜单 + 固定日志窗口的布局方式，实现一屏显示所有内容，无需滚动。

## 主要改进

### 1. Tab导航结构
- **设备管理**：健康检查、设备注册
- **安全检测**：威胁扫描、状态查看
- **交易处理**：交易鉴证、处理、完整流程演示

### 2. 下拉菜单设计
- 每个Tab使用下拉菜单替代多个按钮
- 节省垂直空间，界面更简洁
- 操作选项清晰分组

### 3. 日志显示优化
- 日志窗口固定显示在下半屏
- 请求/响应日志左右并排显示
- 占据屏幕下半部分，无需展开/折叠
- 实时显示通信内容

### 4. 一屏显示
- 上半屏：Tab内容 + 状态 + 操作菜单
- 下半屏：通信日志（请求/响应）
- 无需滚动即可查看所有信息

## 布局结构

```
┌─────────────────────────────────┐
│  Header (固定)                   │
│  - 标题                          │
│  - Backend URL 输入框            │
├─────────────────────────────────┤
│  Tab Row                        │
│  [设备管理] [安全检测] [交易处理] │
├─────────────────────────────────┤
│  Tab Content (上半屏 50%)        │
│  - 状态卡片                      │
│  - 输入字段 (仅交易页面)         │
│  - 下拉菜单按钮                  │
├─────────────────────────────────┤
│  通信日志 (下半屏 50%)           │
│  ┌──────────┬──────────┐        │
│  │ 请求 ▶   │ ◀ 响应   │        │
│  │          │          │        │
│  │  (橙色)  │  (绿色)  │        │
│  └──────────┴──────────┘        │
└─────────────────────────────────┘
```

## 使用体验

### 设备管理页面
1. 点击"选择操作 ▼"打开下拉菜单
2. 选择"健康检查"测试后端连接
3. 选择"注册设备"完成设备注册
4. 注册成功后自动保存设备ID
5. 状态和日志实时更新

### 安全检测页面
1. 点击"选择操作 ▼"打开下拉菜单
2. 选择"扫描威胁"执行安全检测
3. 选择"查看威胁状态"查看当前威胁信息
4. 需要先在设备管理页面注册设备
5. 日志窗口显示扫描过程

### 交易处理页面
1. 在顶部输入交易金额和卡号
2. 点击"选择操作 ▼"打开下拉菜单
3. 选择"1. 交易鉴证"获取交易令牌
4. 选择"2. 交易处理"执行交易
5. 或选择"完整流程演示"一键完成
6. 选择"查看令牌状态"查看当前令牌
7. 日志窗口实时显示请求和响应

## 技术细节

### 组件拆分
- `RegistrationScreen`: 主容器，管理Tab切换和布局
- `DeviceManagementTab`: 设备管理功能（下拉菜单）
- `SecurityTab`: 安全检测功能（下拉菜单）
- `TransactionTab`: 交易处理功能（下拉菜单 + 输入框）
- `LogsSection`: 固定日志显示区域

### 下拉菜单实现
每个Tab使用`DropdownMenu`组件：
```kotlin
var expanded by remember { mutableStateOf(false) }

Button(onClick = { expanded = true }) {
    Text("选择操作 ▼")
}

DropdownMenu(
    expanded = expanded,
    onDismissRequest = { expanded = false }
) {
    DropdownMenuItem(
        text = { Text("操作名称") },
        onClick = { /* 执行操作 */ }
    )
}
```

### 状态共享
使用`AppState`数据类在所有Tab间共享状态：
```kotlin
data class AppState(
    var status: String,
    var baseUrl: String,
    var detailedInfo: String,
    var inputLogs: String,
    var outputLogs: String,
    var transactionAmount: String,
    var cardNumber: String
)
```

### 布局权重
- 上半屏（Tab内容）：`weight(1f)`
- 下半屏（日志区域）：`weight(1f)`
- 日志左右分栏：各占`weight(1f)`

### 日志实时更新
通过回调函数实时更新日志内容：
```kotlin
{ log ->
    if (log.type == "REQUEST") {
        appState.inputLogs += log.toDisplayString()
    } else {
        appState.outputLogs += log.toDisplayString()
    }
}
```

## 优势特点

1. **一屏显示**：无需滚动即可查看所有信息
2. **操作简洁**：下拉菜单减少界面混乱
3. **日志可见**：实时查看通信过程
4. **左右对比**：请求/响应并排显示，便于对比
5. **状态清晰**：顶部状态卡片动态变色

## 测试建议

1. 测试下拉菜单展开/收起
2. 验证日志实时更新
3. 检查一屏是否完整显示
4. 测试Tab切换时状态保持
5. 验证不同屏幕尺寸的适配
